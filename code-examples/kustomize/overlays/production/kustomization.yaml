apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: simple-web-app-production

resources:
- ../../base

namePrefix: prod-
nameSuffix: -production

commonLabels:
  environment: production
  tier: production

replicas:
- name: simple-web-app
  count: 3

images:
- name: nginx
  newTag: 1.21-alpine

configMapGenerator:
- name: app-config
  behavior: merge
  literals:
  - app.environment=production
  - debug.enabled=false
  - app.version=1.0.0

patchesStrategicMerge:
- ingress-patch.yaml
- deployment-patch.yaml

patches:
- target:
    kind: ConfigMap
    name: app-config
  patch: |-
    - op: replace
      path: /data/app.properties
      value: |
        app.name=Simple Web Application
        app.version=1.0.0
        app.environment=production
        debug.enabled=false
        log.level=WARN
        security.enabled=true